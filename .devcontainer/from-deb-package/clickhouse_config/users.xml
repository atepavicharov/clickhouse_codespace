<clickhouse>
    <roles> <!-- based on https://clickhouse.com/docs/operations/settings/settings-users#roles -->
        <db_admin>
            <grants>
                <query>GRANT SHOW, SELECT, INSERT, ALTER, CREATE, DROP, UNDROP TABLE, TRUNCATE, OPTIMIZE, BACKUP, KILL QUERY, KILL TRANSACTION, MOVE PARTITION BETWEEN SHARDS, ACCESS MANAGEMENT, SYSTEM, dictGet, displaySecretsInShowAndSelect, INTROSPECTION, SOURCES, CLUSTER ON *.*</query>
                <query>GRANT ALTER NAMED COLLECTION, CREATE NAMED COLLECTION, DROP NAMED COLLECTION, SHOW NAMED COLLECTIONS, NAMED COLLECTION ON * WITH GRANT OPTION</query>
            </grants>
        </db_admin>
    </roles>
    <users>
        <default remove="remove"></default>
        <admin>
            <password>admin</password>
            <grants>
                <query>GRANT db_admin</query>
            </grants>
            <networks>
                <ip>127.0.0.1</ip>
            </networks>
            <!-- <access_management>1</access_management> --> <!-- so the user can create other users. Tbh it works without this line.-->
        </admin>
    </users>
    <profiles>
        <default>
            <max_threads>2</max_threads>
            <queue_max_wait_ms>1000</queue_max_wait_ms>
            <max_execution_time>600</max_execution_time>
            <input_format_parallel_parsing>0</input_format_parallel_parsing>
            <output_format_parallel_formatting>0</output_format_parallel_formatting>
            <max_bytes_before_external_group_by>3221225472</max_bytes_before_external_group_by> <!-- 3 GB -->
            <max_bytes_before_external_sort>3221225472</max_bytes_before_external_sort> <!-- 3 GB -->
            <!-- additional -->
            <max_memory_usage>6442450944</max_memory_usage> <!-- 6 GB. Recommended to set it about twice higher than max_bytes_before_external_group_by -->
            <join_use_nulls>1</join_use_nulls>
            <group_by_use_nulls>1</group_by_use_nulls>
            <join_algorithm>auto</join_algorithm>
            <!-- <max_bytes_in_join></max_bytes_in_join> -->
            <default_max_bytes_in_join>1073741824</default_max_bytes_in_join> <!-- 1 GB -->
        </default>
    </profiles>
</clickhouse>
